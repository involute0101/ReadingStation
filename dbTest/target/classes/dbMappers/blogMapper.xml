<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--<select id="selectId" resultType="com.dbtest.pojo.Blog" resultMap="blogResultMap">
    select *
    from blog
             left outer join author
                             on blog.authorName=author.authorName
             left outer join article
                             on blog.authorName=article.authorName
             left outer join comments
                             on article.articleName=comments.articleName
             left outer join labels
                             on article.articleName=labels.articleName
    where blog.id = #{id}
</select>-->
<mapper namespace="com.dbtest.dao.BlogMappers">
    <select id="selectBlog" resultType="com.dbtest.pojo.Blog" resultMap="blogResultMap">
        select *from blog
                         left outer join author
                                         on blog.authorName=author.authorName
                         left outer join article
                                         on blog.authorName=article.authorName
                         left outer join comments
                                         on article.articleName=comments.articleName
                         left outer join labels
                                         on article.articleName=labels.articleName
    </select>
    <select id="selectAuthor" resultType="com.dbtest.pojo.Author" resultMap="authorResult">
        select *from author
        where authorName=#{authorName}
    </select>
    <resultMap id="blogResultMap" type="com.dbtest.pojo.Blog" >
        <id  property="id" column="id"></id>
        <result property="state" column="state" typeHandler="com.dbtest.dao.handlers.selfTypeHandler"></result>
        <association property="author" javaType="com.dbtest.pojo.Author" select="selectAuthor" column="authorName" ></association>
        <collection property="articles" ofType="com.dbtest.pojo.Article" resultMap="articleResult" ></collection>
    </resultMap>
    <resultMap id="authorResult" type="com.dbtest.pojo.Author">
        <result property="name" column="authorName"></result>
        <result property="birthDate" column="birthdate"></result>
        <result property="sex" column="sex"></result>
    </resultMap>
    <resultMap id="articleResult" type="com.dbtest.pojo.Article" >
        <result property="articleName" column="articleName"></result>
        <result property="authorName" column="authorName"></result>
        <collection property="comments" ofType="com.dbtest.pojo.Comment" resultMap="commendResult"></collection>
        <collection property="labels" ofType="com.dbtest.pojo.Label" resultMap="labelResult"></collection>
        <discriminator javaType="int" column="isDraft">
            <case value="1" resultType="com.dbtest.pojo.DraftPost"/>
        </discriminator>
    </resultMap>
    <resultMap id="commendResult" type="com.dbtest.pojo.Comment">
        <result property="id" column="commentid"></result>
        <result property="comment" column="comment"></result>
    </resultMap>
    <resultMap id="labelResult" type="com.dbtest.pojo.Label">
        <result property="id" column="labelid"></result>
        <result property="label" column="label"></result>
    </resultMap>

</mapper>